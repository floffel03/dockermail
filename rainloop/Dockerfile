FROM mail-base

RUN apt-get install -y --force-yes git

RUN git clone -b 1.6.9 --depth 1 https://github.com/RainLoop/rainloop-webmail.git /var/www

RUN apt-get install -y --force-yes apache2 php5 libapache2-mod-php5 php5-curl php5-json

# Force initialization of data directories triggered at first program start
RUN php /var/www/index.php

RUN chown -R www-data:www-data /var/www

ADD ./create_config.sh /create_config.sh

RUN bash ./create_config.sh

# The default path is /var/www/html, but the repo was cloned into /var/www. So we need to change the default path
RUN sed -i 's/\/var\/www\/html/\/var\/www/g' /etc/apache2/sites-enabled/000-default.conf

ENTRYPOINT apachectl -DFOREGROUND
